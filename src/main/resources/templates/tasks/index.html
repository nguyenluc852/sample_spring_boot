<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="utf-8" />

<link rel="stylesheet" href="/css/bootstrap.css" />
<link rel="stylesheet"
	href="http://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" />
<script
	src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="/js/bootstrap.js"></script>

<link rel="stylesheet" href="/css/task_index.css" />

<title>Task Manager</title>
</head>

<script type="text/javascript">
	function updateTask(taskId) {
		// your code that does something with param

		$.ajax({
			type : "POST",
			url : "/tasks/complete_task/" + taskId,
			data : {
				id : taskId
			},

			success : function(data) {
				location.reload();
				$("#alertSuccess").show(); //or fadeIn
				setTimeout(function() {
					$("#alertSuccess").hide(); //or fadeOut
				}, 5000);
			}
		});

	};

	function redirectEdit(id) {
		window.location.href = "/tasks/" + id + "/edit";
	}

	function redirectCreate() {
		window.location.href = "/tasks/new";
	}
	var listIDDelete = [];
	function getListIdDelete(id) {

		if ($("#cb_delete" + id).is(':checked')) {
			listIDDelete.push(id);
		} else {
			//uncheck - clear input

			const index = listIDDelete.indexOf(id);
			if (index > -1) {
				listIDDelete.splice(index, 1);
			}
		}

		console.log(listIDDelete);
	}

	function deleteListId() {
		if (listIDDelete.length > 0) {
			var r = confirm("Are you sure! Delete task");
			if (r == true) {
				$.ajax({
					type : "post",
					url : "/tasks/delete/" + listIDDelete,
					data : {
						listId : listIDDelete
					},

					success : function(data) {
						listIDDelete = [];
						location.reload()

					}
				});
			}
		}

	}
</script>
<body>

	<div align="center">
		<div id="alertSuccess" class="alert alert-success  float-right"
			style="display: none" role="alert">Change task completed</div>
		<h1>タスク一覧</h1>

		<button type="button" class="btn btn-outline-primary"
			onclick="redirectCreate()">タスク登録</button>

		<div class="container px-lg-6">

			<div class="row mx-lg-n6" style="margin-left: -80px;margin-right: -80px;">
				<div class="col-lg-12" style="margin-bottom: 10px;">
					<button type="button" class="btn btn-outline-danger float-right"
						style="width: 100px;" onclick="deleteListId()">削除</button>
				</div>
				<p></p>
				<p></p>
				<div class="col py-3 px-lg-6 border bg-light">
					<h2>未完了</h2>

					<div th:if="${#lists.isEmpty(listTasksUnComplete)}">
						<div>未完了タスクがありません</div>
					</div>
					<div th:unless="${#lists.isEmpty(listTasksUnComplete)}" class="table-responsive-md">
					<div></div>
						<table class="table table-hover table-bordered tableBodyScroll" >
				        <thead>
				            <tr>
				                <th>タイトル</th>
				                <th style="width: 110px;">予定日</th>
				                <th style="width: 110px;">完了日</th>
				                <th style="width: 90px;">優先順位</th>
				                <th style="width: 60px;">完了</th>
				                <th style="width: 60px;">削除</th>
				            </tr>
				        </thead>
				        
				        <tbody>
				            <tr th:each="task : ${listTasksUnComplete}">
				                <td th:text=${task.title} th:onclick="'redirectEdit(\'' +${task.id} +'\')'">Title</td>
				                <td th:text="${task.scheduled_date}" style="width: 110px;" th:onclick="'redirectEdit(\'' +${task.id} +'\')'">予定日</td>
				                <td th:text="${task.complete_date}" style="width: 110px;" th:onclick="'redirectEdit(\'' +${task.id} +'\')'">完了日</td>
				                <td th:switch="${task.priority}" style="width: 90px;" th:onclick="'redirectEdit(\'' +${task.id} +'\')'">
									<small th:case="1">High</small> <small th:case="2">Medium</small> <small th:case="3">Normal</small> <small
										th:case="4">Low</small>
								</td>
								<td style="width: 60px;" th:onclick="'updateTask(\'' +${task.id} +'\')'">
									<input   type="checkbox"
											th:data-id="${task.id}" th:name="'complete_flg'+ ${task.id}"
											th:id="'complete_flg'+ ${task.id}"  
											 /> 
								</td>
				                <td style="width: 60px;" th:onclick="'getListIdDelete(\'' +${task.id} +'\')'"><input class="checkbox_delete" type="checkbox"
										th:data-id="${task.id}" th:name="'cb_delete'+ ${task.id}"
										th:id="'cb_delete'+ ${task.id}"
										></td>	               
				            </tr>
				        </tbody>
				        </table> 
				
					</div>
				</div>


				<div class="col py-3 px-lg-6 border bg-light">
					<h2>完了</h2>
					<div th:if="${#lists.isEmpty(listTasksComplete)}">
						<div>完了タスクがありません</div>
					</div>
					<div th:unless="${#lists.isEmpty(listTasksComplete)}" class="table-responsive-md">
					
						<table class="table table-hover table-bordered tableBodyScroll" >
				        <thead>
				            <tr>
				                <th>タイトル</th>
				                <th style="width: 110px;">予定日</th>
				                <th style="width: 110px;">完了日</th>
				                <th style="width: 90px;">優先順位</th>
				               
				                <th style="width: 60px;">削除</th>
				            </tr>
				        </thead>
				        
				        <tbody>
				            <tr th:each="task : ${listTasksComplete}">
				                <td th:text=${task.title}>Title</td>
				                <td th:text="${task.scheduled_date}" style="width: 110px;" th:onclick="'redirectEdit(\'' +${task.id} +'\')'">予定日</td>
				                <td th:text="${task.complete_date}" style="width: 110px;" th:onclick="'redirectEdit(\'' +${task.id} +'\')'">完了日</td>
				                <td th:switch="${task.priority}" style="width: 90px;" th:onclick="'redirectEdit(\'' +${task.id} +'\')'">
									<small th:case="1">High</small> <small th:case="2">Medium</small> <small th:case="3">Normal</small> <small
										th:case="4">Low</small>
								</td>
				                <td style="width: 60px;" th:onclick="'getListIdDelete(\'' +${task.id} +'\')'"><input class="checkbox_delete" type="checkbox"
										th:data-id="${task.id}" th:name="'cb_delete'+ ${task.id}"
										th:id="'cb_delete'+ ${task.id}"
										></td>	               
				            </tr>
				        </tbody>
				        </table>
						
					</div>
				</div>
			</div>
		</div>
	</div>
</body>
</html>